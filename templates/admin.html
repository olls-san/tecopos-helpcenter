{% extends "base.html" %}

{% block title %}Gestión – Centro de Ayuda Tecopos{% endblock %}

{% block content %}
<section class="section">
    <div class="section-header">
        <h1>Gestión de artículos</h1>
        <p>Crear, actualizar y eliminar errores, guías y documentación interna.</p>
    </div>

    <div class="admin-grid">
        <div class="admin-form">
            <h2>Nuevo artículo</h2>
            <form action="/admin/create" method="post" enctype="multipart/form-data" class="form-vertical">
                <label>Tipo de artículo</label>
                <select name="type" required>
                    <option value="error">Error / Incidencia</option>
                    <option value="guia">Guía</option>
                    <option value="comportamiento">Comportamiento / Buenas prácticas</option>
                    <option value="faq">FAQ</option>
                    <option value="novedad">Novedad</option>
                </select>

                <label>Título</label>
                <input type="text" name="title" required />

                <label>Descripción corta</label>
                <input type="text" name="short_description" required />

                <label>Categoría</label>
                <input type="text" name="category" placeholder="ej. ventas, inventario, roles-permisos..." required />

                <label class="checkbox-inline">
                    <input type="checkbox" name="is_common" value="true" />
                    Marcar como error / documento frecuente
                </label>

                <label>Mensaje que ve el cliente</label>
                <textarea name="client_message" rows="2" required></textarea>

                <label>Posibles causas (una por línea)</label>
                <textarea name="causes" rows="3"></textarea>

                <label>Pasos rápidos para el usuario (una por línea)</label>
                <textarea name="quick_steps" rows="3"></textarea>

                <label>Pasos internos / notas para soporte (una por línea)</label>
                <textarea name="internal_steps" rows="3"></textarea>

                <label>Imágenes (puedes seleccionar varias)</label>
                <input type="file" name="image_files" multiple />

                <label>Video (opcional)</label>
                <input type="file" name="video_file" />

                <button type="submit">Crear artículo</button>
            </form>
        </div>

        <div class="admin-list">
            <h2>Artículos existentes</h2>

            {% if errors %}
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tipo</th>
                        <th>Título</th>
                        <th>Categoría</th>
                        <th>Frecuente</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for e in errors %}
                    <tr>
                        <td>{{ e.id }}</td>
                        <td>{{ e.type }}</td>
                        <td><a href="/errors/{{ e.id }}" target="_blank">{{ e.title }}</a></td>
                        <td>{{ e.category }}</td>
                        <td>{% if e.is_common %}Sí{% else %}No{% endif %}</td>
                        <td>
                            <form action="/admin/delete/{{ e.id }}" method="post" onsubmit="return confirm('¿Eliminar este artículo?');">
                                <button type="submit" class="btn-danger">Eliminar</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
                <p>Aún no hay artículos registrados.</p>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
